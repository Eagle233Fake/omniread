# 用户认证模块开发计划

本计划旨在实现一个完整的用户认证系统，包含注册、登录、数据校验及安全保护功能。

## 1. 依赖管理
- 添加 `go.mongodb.org/mongo-driver` 用于 MongoDB 操作。
- 添加 `github.com/golang-jwt/jwt/v5` 用于 JWT 生成与验证。
- 确认 `golang.org/x/crypto` 用于密码加密 (Bcrypt)。

## 2. 数据模型层 (Model Layer)
文件: `backend/model/user.go`
- 定义 `User` 结构体，包含 `BSON` 标签。
- 字段: `_id`, `username`, `email`, `phone`, `password`, `gender`, `birthdate`, `avatar`, `bio`, `createdAt`, `updatedAt`, `lastLoginAt`, `status`.
- 实现数据库初始化与索引创建 (确保 `username`, `email`, `phone` 唯一)。
- 实现 CRUD 操作方法: `Create`, `FindByID`, `FindByUsername`, `FindByEmail`, `FindByPhone`.

## 3. 服务层 (Service Layer)
文件: `backend/service/auth/auth.go`
- **注册逻辑**:
  - 校验必填项及格式 (邮箱正则, 手机号11位, 密码强度)。
  - 检查唯一性 (用户名, 邮箱, 手机号)。
  - 密码加密 (Bcrypt)。
  - 创建用户。
- **登录逻辑**:
  - 支持 用户名/邮箱/手机号 + 密码 登录。
  - 验证密码。
  - 生成 JWT Token。
  - 更新 `lastLoginAt`。
- **辅助功能**:
  - Token 生成与解析。

## 4. 接口层 (Handler Layer)
文件: `backend/api/handler/auth.go`
- `RegisterHandler`: 解析请求体，调用 Service 注册，返回结果。
- `LoginHandler`: 解析请求体，调用 Service 登录，返回 Token 和用户信息。
- 定义请求/响应结构体 (DTO)。

## 5. 路由与配置 (Router & Config)
文件: `backend/api/router/router.go`
- 注册路由组 `/auth`。
- 添加 `POST /auth/register`。
- 添加 `POST /auth/login`。

文件: `backend/provider/provider.go`
- 初始化 MongoDB 客户端连接。
- 将 DB 实例注入到 Model/Service 中。

## 6. 安全与扩展
- 密码不在响应中返回。
- 登录接口简单的防爆破 (可通过 Redis 计数实现，视进度而定)。
- 预留扩展字段。

## 7. 验证
- 编写简单的单元测试或使用 curl/Postman 进行接口测试。
